<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <title>Bitonic Sort Visual</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      background: #1e1e2f;
      color: white;
    }

    #barras {
      display: flex;
      align-items: flex-end;
      justify-content: center;
      height: 300px;
      width: 100%;
      margin: 20px auto;
      gap: 6px;
      transition: all 0.5s ease;
    }

    .barra {
      width: 20px;
      background-color: #4fc3f7;
      transition: height 0.3s ease, transform 0.3s ease;
      position: relative;
      text-align: center;
    }

    .barra span {
      position: absolute;
      top: -22px;
      left: 0;
      width: 100%;
      font-size: 10px;
      color: white;
      text-align: center;
      transform: translateX(0);
    }

    button {
      margin: 10px;
      padding: 10px 20px;
      background: #4fc3f7;
      border: none;
      color: black;
      font-weight: bold;
      cursor: pointer;
      border-radius: 8px;
    }

    button:hover {
      background: #81d4fa;
    }

    #explicacao {
      margin-top: 20px;
      padding: 10px;
      background: #333;
      border-radius: 10px;
      max-width: 800px;
      text-align: center;
      white-space: pre-line;
    }

    #controlePasso {
      margin-top: 10px;
    }

    #historico {
      margin-top: 20px;
      background: #222;
      padding: 10px;
      max-width: 800px;
      width: 90%;
      border-radius: 10px;
      overflow-y: auto;
      max-height: 200px;
      font-size: 14px;
    }

    .linhaHistorico {
      padding: 3px 5px;
      margin: 2px 0;
      border-radius: 4px;
    }

    .comparacao {
      background-color: rgba(46, 204, 113, 0.3);
      color: #2ecc71;
    }

    .divisao {
      background-color: rgba(241, 196, 15, 0.3);
      color: #f1c40f;
    }
  </style>
</head>

<body>
  <h1>Bitonic Sort - Visualizador</h1>
  <div>
    <button onclick="embaralharBarras()">üîÄ Embaralhar</button>
    <button onclick="iniciarOrdenacao()">üöÄ Ordenar</button>
    <button onclick="arrayFinal()">‚úì Array Final</button>
  </div>
  <div id="barras"></div>
  <div id="explicacao"></div>
  <div id="controlePasso" style="display: none;">
    <button onclick="passoAnterior()">‚¨ÖÔ∏è Passo Anterior</button>
    <button onclick="proximoPasso()">Seguir ‚û°Ô∏è</button>
  </div>
  <div id="historico"></div>

  <script>
    const numBarras = 8;
    let valores = [];
    let passoAtual = null;
    let filaPassos = [];
    let indicePassoAtual = 0;
    let listaHistorico = [];
    let indicesDestacados = [];
    let indicesDivisao = [];

    function criarBarras() {
      const container = document.getElementById('barras');
      container.innerHTML = '';
      valores.forEach((altura, i) => {
        const barra = document.createElement('div');
        barra.className = 'barra';
        barra.style.height = altura + 'px';
        if (indicesDestacados.includes(i)) {
          barra.style.backgroundColor = '#e74c3c';
        } else if (indicesDivisao.includes(i)) {
          barra.style.backgroundColor = '#f1c40f';
        }
        const rotulo = document.createElement('span');
        rotulo.textContent = altura;
        barra.appendChild(rotulo);
        container.appendChild(barra);
      });
    }

    function embaralharBarras() {
      valores = Array.from({ length: numBarras }, () => Math.floor(Math.random() * 280 + 20));
      indicesDestacados = [];
      indicesDivisao = [];
      criarBarras();
      filaPassos = [];
      indicePassoAtual = 0;
      listaHistorico = [];
      atualizarHistorico();
      document.getElementById('explicacao').innerText = 'Vetor embaralhado:\n' + JSON.stringify(valores);
      document.getElementById('controlePasso').style.display = 'none';
    }

    function esperar(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    function mostrarExplicacao(texto) {
      const formatarVetorVisual = (array) => {
        const grupos = [];
        let tamanho = array.length;
        while (tamanho % 2 === 0) tamanho /= 2;
        const tamanhoGrupo = array.length / tamanho;
        for (let i = 0; i < array.length; i += tamanhoGrupo) {
          grupos.push(array.slice(i, i + tamanhoGrupo));
        }
        return grupos.map(g => '[' + g.join(', ') + ']').join('    ');
      };

      const vetorAtual = 'Estado atual do vetor:\n' + formatarVetorVisual(valores);
      document.getElementById('explicacao').innerText = texto + '\n\n' + vetorAtual;
      document.getElementById('controlePasso').style.display = 'block';

      indicesDestacados = passoAtual?.indices || [];
      indicesDivisao = passoAtual?.divisoes || [];
      criarBarras();
    }

    function atualizarHistorico() {
      const divHistorico = document.getElementById('historico');
      divHistorico.innerHTML = '<div>Hist√≥rico de passos:</div>';
      
      listaHistorico.forEach((item, index) => {
        const linha = document.createElement('div');
        linha.className = 'linhaHistorico';
        linha.textContent = item;
        
        // Adicionar classe baseada no conte√∫do da linha
        if (item.includes("Comparando valores")) {
          linha.classList.add('comparacao');
        } else if (item.includes("Dividindo subarray")) {
          linha.classList.add('divisao');
        }
        
        divHistorico.appendChild(linha);
      });
    }

    function passoAnterior() {
      if (indicePassoAtual > 1) {
        // Remover a √∫ltima linha do hist√≥rico
        if (listaHistorico.length > 0) {
          listaHistorico.pop();
        }
        
        indicePassoAtual -= 2;
        atualizarHistorico();
        proximoPasso();
      } else if (indicePassoAtual === 1) {
        // Remover a √∫ltima linha do hist√≥rico
        if (listaHistorico.length > 0) {
          listaHistorico.pop();
        }
        
        indicePassoAtual = 0;
        atualizarHistorico();
        proximoPasso();
      }
    }

    async function proximoPasso() {
      if (indicePassoAtual < filaPassos.length) {
        passoAtual = filaPassos[indicePassoAtual++];
        
        // Configurar as barras destacadas primeiro
        indicesDestacados = passoAtual.indices || [];
        indicesDivisao = passoAtual.divisoes || [];
        criarBarras();
        
        // Agora, com as barras j√° destacadas, coletamos os valores atuais
        let textoBase = passoAtual.textoBase || passoAtual.texto;
        let textoDetalhado = "";
        
        if (textoBase.includes("Comparando valores")) {
          // Colete os valores atuais das barras vermelhas para o texto de exibi√ß√£o
          const valoresVermelhos = indicesDestacados.map(idx => valores[idx]);
          textoDetalhado = `Comparando valores ${valoresVermelhos.join(' e ')} para ${passoAtual.direcao ? 'crescente' : 'decrescente'}.`;
          
          // Colete os valores para o hist√≥rico
          const valoresVermelhosComIndices = indicesDestacados.map(idx => `${idx}:${valores[idx]}`).join(", ");
          listaHistorico.push(`${textoDetalhado} [Vermelho: ${valoresVermelhosComIndices}]`);
        } else if (textoBase.includes("Dividindo subarray")) {
          textoDetalhado = textoBase;
          // Colete os valores atuais das barras amarelas
          const valoresAmarelos = indicesDivisao.map(idx => `${idx}:${valores[idx]}`).join(", ");
          listaHistorico.push(`${textoDetalhado} [Amarelo: ${valoresAmarelos}]`);
        }
        
        atualizarHistorico();
        mostrarExplicacao(textoDetalhado || textoBase);
        
        if (passoAtual.acao) {
          await passoAtual.acao();
          criarBarras();
        }
      } else {
        document.getElementById('controlePasso').style.display = 'none';
        indicesDestacados = [];
        indicesDivisao = [];
        mostrarExplicacao('Ordena√ß√£o completa!');
      }
    }

    function adicionarPasso(texto, acao = null, indices = [], divisoes = [], direcao = true) {
      filaPassos.push({ 
        textoBase: texto, 
        acao, 
        indices, 
        divisoes,
        direcao
      });
    }

    async function BitonicSort(inicio, comprimento, direcao) {
      if (comprimento <= 1) return;
      const metade = comprimento / 2;
      const intervalo = Array.from({ length: comprimento }, (_, i) => i + inicio);
      adicionarPasso(`Dividindo subarray de tamanho ${comprimento} em duas partes.`, async () => {
        await esperar(300);
      }, [], intervalo);
      await BitonicSort(inicio, metade, true);
      await BitonicSort(inicio + metade, metade, false);
      await BitonicMerge(inicio, comprimento, direcao);
    }

    async function BitonicMerge(inicio, comprimento, direcao) {
      if (comprimento <= 1) return;
      const metade = comprimento / 2;
      for (let i = inicio; i < inicio + metade; i++) {
        adicionarPasso(
          `Comparando valores`,
          async () => {
            await esperar(300);
            if ((valores[i] > valores[i + metade]) === direcao) {
              [valores[i], valores[i + metade]] = [valores[i + metade], valores[i]];
              await esperar(300);
            }
          },
          [i, i + metade],
          [],
          direcao
        );
      }
      await BitonicMerge(inicio, metade, direcao);
      await BitonicMerge(inicio + metade, metade, direcao);
    }

    // Fun√ß√£o para ordenar o array sem visualiza√ß√£o passo a passo
    function bitonicSortDireta(arr, inicio, comprimento, direcao) {
      if (comprimento <= 1) return;
      const metade = comprimento / 2;
      bitonicSortDireta(arr, inicio, metade, true);
      bitonicSortDireta(arr, inicio + metade, metade, false);
      bitonicMergeDireta(arr, inicio, comprimento, direcao);
    }

    function bitonicMergeDireta(arr, inicio, comprimento, direcao) {
      if (comprimento <= 1) return;
      const metade = comprimento / 2;
      for (let i = inicio; i < inicio + metade; i++) {
        if ((arr[i] > arr[i + metade]) === direcao) {
          [arr[i], arr[i + metade]] = [arr[i + metade], arr[i]];
        }
      }
      bitonicMergeDireta(arr, inicio, metade, direcao);
      bitonicMergeDireta(arr, inicio + metade, metade, direcao);
    }

    // Fun√ß√£o para o bot√£o "Array Final"
    function arrayFinal() {
      // Criar uma c√≥pia do array atual para ordenar
      const arrOrdenado = [...valores];
      bitonicSortDireta(arrOrdenado, 0, arrOrdenado.length, true);
      // Substituir o array atual pelo ordenado
      valores = arrOrdenado;
      
      // Limpar destaque e mostrar explica√ß√£o
      indicesDestacados = [];
      indicesDivisao = [];
      filaPassos = [];
      indicePassoAtual = 0;
      listaHistorico = [];
      listaHistorico.push("Array ordenado diretamente.");
      atualizarHistorico();
      
      document.getElementById('explicacao').innerText = 'Array ordenado diretamente sem passos intermedi√°rios:\n' + JSON.stringify(valores);
      document.getElementById('controlePasso').style.display = 'none';
      
      // Atualizar a visualiza√ß√£o
      criarBarras();
    }

    async function iniciarOrdenacao() {
      filaPassos = [];
      indicePassoAtual = 0;
      listaHistorico = [];
      indicesDestacados = [];
      indicesDivisao = [];
      atualizarHistorico();
      await BitonicSort(0, valores.length, true);
      proximoPasso();
    }

    embaralharBarras();
  </script>
</body>

</html>